"use strict";(self.webpackChunk_wintercms_wn_backend_module=self.webpackChunk_wintercms_wn_backend_module||[]).push([[466],{243:function(){class t{constructor(t,e){this.widget=t,this.editor=e,this.button=null}bindButton(t){this.button=t}icon(){return"location-crosshairs"}tooltip(){return null}shortcutKey(){return null}status(){return null}isDropdown(){return!1}dropdownItems(){return[]}isActive(){return!1}isEnabled(){return!1}action(){}}class e extends t{icon(){return"italic"}tooltip(){return"Italic"}shortcutKey(){return"I"}isActive(){return!(!this.editor||!this.editor.getModel())&&(this.isCurrentWordItalic()||this.isCurrentSelectionItalic())}isEnabled(){return!0}action(){if(this.editor.getSelection().isEmpty()){const t=this.selectCurrentWord();if(t&&this.isCurrentWordItalic())return this.editor.getEditor().setSelection({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-1,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+1}),this.editor.unwrap("*","*"),void this.editor.focus();if(t&&this.isCurrentWordBold())return this.editor.getEditor().setSelection({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-2,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+2}),this.editor.unwrap("**","**"),this.editor.wrap("*","*"),void this.editor.focus();t&&this.editor.getEditor().setSelection(t.selection)}else{if(this.isCurrentSelectionItalic()){const t=this.editor.getSafeSelection();return/^\*[^*]/.test(this.editor.getModel().getValueInRange(t))&&/[^*]\*$/.test(this.editor.getModel().getValueInRange(t))?this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn+1,endLineNumber:t.endLineNumber,endColumn:t.endColumn-1}):this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn-1,endLineNumber:t.endLineNumber,endColumn:t.endColumn+1}),this.editor.unwrap("*","*"),void this.editor.focus()}if(this.isCurrentSelectionBold()){const t=this.editor.getSafeSelection();return/^\*\*/.test(this.editor.getModel().getValueInRange(t))&&/\*\*$/.test(this.editor.getModel().getValueInRange(t))?this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn+2,endLineNumber:t.endLineNumber,endColumn:t.endColumn-2}):this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn-2,endLineNumber:t.endLineNumber,endColumn:t.endColumn+2}),this.editor.unwrap("**","**"),this.editor.wrap("*","*"),void this.editor.focus()}}this.editor.wrap("*","*"),this.editor.focus()}selectCurrentWord(){const t=this.editor.getSelection().toJSON(),e=this.editor.getModel().getValueInRange(t);if(t.startLineNumber!==t.endLineNumber||e.includes(" "))return null;const i=this.editor.getPosition(),n=this.editor.getModel().getWordAtPosition(i);return n?{word:n.word,selection:{startLineNumber:i.lineNumber,startColumn:n.startColumn,endLineNumber:i.lineNumber,endColumn:n.endColumn}}:null}isCurrentWordBold(){const t=this.getExpandedWord();return!1!==t&&(t.startsWith("**")&&t.endsWith("**"))}isCurrentWordItalic(){const t=this.getExpandedWord();return!1!==t&&(/^[^*]\*/.test(t)&&/\*[^*]$/.test(t))}isCurrentSelectionBold(){const t=this.editor.getSelection().toJSON();if(/^\*\*/.test(this.editor.getModel().getValueInRange(t))&&/\*\*$/.test(this.editor.getModel().getValueInRange(t)))return!0;const e=this.getExpandedSelection();return!1!==e&&(e.startsWith("**")&&e.endsWith("**"))}isCurrentSelectionItalic(){const t=this.editor.getSelection().toJSON();if(/^\*[^*]/.test(this.editor.getModel().getValueInRange(t))&&/[^*]\*$/.test(this.editor.getModel().getValueInRange(t)))return!0;const e=this.getExpandedSelection();return!1!==e&&(/^[^*]\*/.test(e)&&/\*[^*]$/.test(e))}getExpandedWord(){const t=this.selectCurrentWord();if(!t)return!1;const e=this.editor.getModel().getLineLength(t.selection.startLineNumber);return t.selection.startColumn<3?t.selection.startColumn=1:t.selection.startColumn-=2,t.selection.endColumn>e-1?t.selection.endColumn=e+1:t.selection.endColumn+=2,this.editor.getModel().getValueInRange({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn})}getExpandedSelection(){const t=this.editor.getSafeSelection();if(t.startLineNumber!==t.endLineNumber)return!1;const e=this.editor.getModel().getLineLength(t.startLineNumber);return t.startColumn<3?t.startColumn=1:t.startColumn-=2,t.endColumn>e-1?t.endColumn=e+1:t.endColumn+=2,this.editor.getModel().getValueInRange({startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn})}}class i extends e{icon(){return"bold"}tooltip(){return"Bold"}shortcutKey(){return"B"}isActive(){return!(!this.editor||!this.editor.getModel())&&(this.isCurrentWordBold()||this.isCurrentSelectionBold())}isEnabled(){return!0}action(){if(this.editor.getSelection().isEmpty()){const t=this.selectCurrentWord();if(t&&this.isCurrentWordItalic())return this.editor.getEditor().setSelection({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-1,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+1}),this.editor.unwrap("*","*"),this.editor.wrap("**","**"),void this.editor.focus();if(t&&this.isCurrentWordBold())return this.editor.getEditor().setSelection({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-2,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+2}),this.editor.unwrap("**","**"),void this.editor.focus();t&&this.editor.getEditor().setSelection(t.selection)}else{if(this.isCurrentSelectionItalic()){const t=this.editor.getSelection();return!1!==/^\*[^*]/.test(this.editor.getModel().getValueInRange(t))&&!1!==/[^*]\*$/.test(this.editor.getModel().getValueInRange(t))||this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn-1,endLineNumber:t.endLineNumber,endColumn:t.endColumn+1}),this.editor.unwrap("*","*"),this.editor.wrap("**","**"),void this.editor.focus()}if(this.isCurrentSelectionBold()){const t=this.editor.getSelection();return!1!==/^\*\*/.test(this.editor.getModel().getValueInRange(t))&&!1!==/\*\*$/.test(this.editor.getModel().getValueInRange(t))||this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn-2,endLineNumber:t.endLineNumber,endColumn:t.endColumn+2}),this.editor.unwrap("**","**"),void this.editor.focus()}}this.editor.wrap("**","**"),this.editor.focus()}}(t=>{class n extends t.PluginBase{construct(t){this.element=t,this.toolbar=t.querySelector(".markdowneditor-toolbar"),this.editorElement=t.querySelector(".markdowneditor-editor"),this.preview=t.querySelector(".markdowneditor-preview"),this.valueBag=t.querySelector("[data-value-bag]"),this.config=this.snowboard.dataConfig(this,this.element),this.previewTimer=null,this.editor=null,this.actions=[],this.events={value:t=>this.onValue(t)},this.createEditor(),this.registerActions(),this.createToolbar()}defaults(){return{refreshHandler:null,useMediaManager:!1}}destruct(){this.editor&&(this.editor.events.off("input",this.events.value),this.editor.destruct())}dependencies(){return["backend.formwidgets.codeeditor"]}createEditor(){this.editor=this.snowboard["backend.formwidgets.codeeditor"](this.editorElement),this.editor.loadTheme("vs"),this.editor.setConfig("fontSize",14),this.editor.setConfig("showGutter",!1),this.editor.setConfig("showMinimap",!1),this.editor.setConfig("showColors",!1),this.editor.setConfig("showScrollbar",!1),this.editor.setConfig("showSuggestions",!1),this.editor.setConfig("displayIndentGuides",!1),this.editor.setConfig("codeFolding",!1),this.editor.setConfig("wordWrap","fluid"),this.editor.setConfig("showOccurrences",!1),this.editor.setConfig("showSelectionOccurrences",!1),this.editor.setConfig("semanticHighlighting",!1),this.editor.events.once("create",(()=>{this.editor.setLanguage("markdown"),this.registerKeyBindings()})),this.editor.events.on("input",this.events.value),this.editor.events.on("position",(()=>{this.updateToolbarButtonStates()})),this.editor.events.on("selection",(()=>{this.updateToolbarButtonStates()}))}onValue(){this.valueBag.value=this.editor.getValue(),this.previewTimer&&clearTimeout(this.previewTimer),this.previewTimer=setTimeout((()=>{this.updatePreview(),this.previewTimer=null}),100)}updatePreview(){this.snowboard.request(this.element,this.config.get("refreshHandler"),{loading:!1,success:t=>{this.preview.innerHTML=t.preview}})}registerActions(){this.actions.push({name:"bold",action:new i(this,this.editor)}),this.actions.push({name:"italic",action:new e(this,this.editor)})}findAction(t){const e=this.actions.find((e=>e.name===t));return e?e.action:null}createToolbar(){this.toolbar.children.length&&this.toolbar.children.forEach((t=>{t.remove()})),this.actions.forEach((t=>{this.toolbar.appendChild(this.createToolbarButton(t))}))}createToolbarButton(t){let{name:e,action:i}=t;const n=document.createElement("button");n.dataset.action=e,i.isActive()&&n.classList.add("active"),i.isDropdown()&&n.classList.add("dropdown"),n.disabled=!i.isEnabled();const o=document.createElement("i");if(o.classList.add(`icon-${i.icon()}`),n.appendChild(o),i.status()){const t=document.createElement("span");t.classList.add("status"),t.innerText=i.status(),n.appendChild(t)}if(i.bindButton(n),i.dropdownItems().length){const t=document.createElement("div");t.classList.add("dropdown");const e=document.createElement("ul");return e.classList.add("dropdown-menu"),e.setAttribute("role","menu"),this.generateDropdownItems(i,e),t.appendChild(n),t.appendChild(e),i.tooltip()&&(t.classList.add("has-tooltip"),t.setAttribute("data-toggle","tooltip"),t.setAttribute("title",i.tooltip()),i.shortcutKey()&&t.setAttribute("title",`${t.getAttribute("title")} (${this.getModifierKey()}${i.shortcutKey()})`)),n.setAttribute("data-toggle","dropdown"),t}return i.tooltip()&&(n.classList.add("has-tooltip"),n.setAttribute("data-toggle","tooltip"),n.setAttribute("title",i.tooltip()),i.shortcutKey()&&n.setAttribute("title",`${n.getAttribute("title")} (${this.getModifierKey()}${i.shortcutKey()})`)),n.addEventListener("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),i.action(),this.updateToolbarButtonStates()})),n}generateDropdownItems(t,e){t.dropdownItems().length&&t.dropdownItems().forEach((t=>{const i=document.createElement("li");i.setAttribute("role","presentation"),t.active&&i.classList.add("active"),t.enabled||i.classList.add("disabled");const n=document.createElement("a");n.setAttribute("role","menuitem"),n.setAttribute("href","#"),t.icon&&n.classList.add(`wn-icon-${t.icon}`),t.label&&(n.innerText=t.label),t.enabled&&n.addEventListener("click",(e=>{e.preventDefault(),t.isEnabled()&&t.action(),this.updateToolbarButtonStates()})),i.appendChild(n),e.appendChild(i)}))}updateToolbarButtonStates(){this.toolbar.querySelectorAll("button[data-action]").forEach((t=>{const e=this.findAction(t.dataset.action);if(e){if(t.querySelector("i").className=`icon-${e.icon()}`,e.status()){let i=t.querySelector(".status");i||(i=document.createElement("span"),i.classList.add("status"),t.appendChild(i)),i.innerText=e.status()}else t.querySelector(".status")&&t.querySelector(".status").remove();if(e.dropdownItems().length){let i=t.parentElement;i.classList.contains("dropdown")||(i=document.createElement("div"),i.classList.add("dropdown")),i.querySelector("ul")&&i.querySelector("ul").remove();const n=document.createElement("ul");n.classList.add("dropdown-menu"),n.setAttribute("role","menu"),this.generateDropdownItems(e,n),i.appendChild(t),i.appendChild(n),e.tooltip()&&i.classList.contains("has-tooltip")&&(i.setAttribute("title",e.tooltip()),e.shortcutKey()&&i.setAttribute("title",`${i.getAttribute("title")} (${this.getModifierKey()}${e.shortcutKey()})`)),t.setAttribute("data-toggle","dropdown")}else e.tooltip()&&t.classList.contains("has-tooltip")&&(t.setAttribute("title",e.tooltip()),e.shortcutKey()&&t.setAttribute("title",`${t.getAttribute("title")} (${this.getModifierKey()}${e.shortcutKey()})`));t.disabled=!e.isEnabled(),e.isActive()?t.classList.add("active"):t.classList.remove("active")}}))}getModifierKey(){let t="^";return 0!==navigator.platform.indexOf("Mac")&&"iPhone"!==navigator.platform||(t="⌘"),t}registerKeyBindings(){this.actions.length&&this.actions.forEach((t=>{t.action.shortcutKey()&&this.editor.addKeyBinding({key:t.action.shortcutKey(),ctrl:!0},(()=>{t.action.isEnabled()&&t.action.action(),this.updateToolbarButtonStates()}))}))}}t.addPlugin("backend.formwidgets.markdowneditor",n),t["backend.ui.widgetHandler"]().register("markdowneditor","backend.formwidgets.markdowneditor")})(window.Snowboard)}},function(t){var e;e=243,t(t.s=e)}]);