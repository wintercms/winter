(self.webpackChunk_wintercms_wn_backend_module=self.webpackChunk_wintercms_wn_backend_module||[]).push([[645],{685:function(){((e,t)=>{class i extends e.PluginBase{construct(e){this.element=e,this.config=this.snowboard.dataConfig(this,e),this.findButton=e.querySelector("[data-find]"),this.fileName=e.querySelector("[data-file-name]"),this.image=e.querySelector("[data-image]"),this.remove=e.querySelector("[data-remove]"),this.value=e.querySelector("[data-value]"),this.item=null,this.mediaManager=null,this.events={find:e=>this.find(e),remove:e=>this.clearValue(e)},this.attachEvents(),["video","image"].includes(this.config.get("mode"))&&(this.config.get("imageHeight")&&(this.image.style.maxHeight=`${this.config.get("imageHeight")}px`),this.config.get("imageWidth")&&(this.image.style.maxWidth=`${this.config.get("imageWidth")}px`))}defaults(){return{mode:"all",isPreview:!1,imageHeight:null,imageWidth:null}}attachEvents(){this.findButton.addEventListener("click",this.events.find),this.remove.addEventListener("click",this.events.remove)}detachEvents(){this.findButton.removeEventListener("click",this.events.find),this.remove.addEventListener("click",this.events.remove)}find(e){e.preventDefault(),e.stopPropagation(),this.mediaManager=new t.wn.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:["image","all"].includes(this.config.get("mode")),mode:"file"===this.config.get("mode")?"all":this.config.get("mode"),onInsert:e=>{e.length?e.length>1?this.snowboard.flash("Please select a single item.","error"):(this.item=e[0],this.setValue(),["video","image"].includes(this.config.get("mode"))?this.updatePreview():this.element.classList.add("is-populated"),this.mediaManager.hide()):this.snowboard.flash(`Please select a ${this.config.get("mode")} to insert.`,"error")}})}setValue(){this.value.value=this.item.path,this.fileName.innerText=this.item.path.substring(1)}clearValue(){this.value.value="",this.fileName.innerText="",this.element.classList.remove("is-populated")}updatePreview(){"video"===this.config.get("mode")?this.getVideoSnapshot():"image"===this.config.get("mode")&&this.getImage()}getVideoSnapshot(){const e=document.createElement("canvas"),t=document.createElement("video");t.width=t.videoWidth,t.height=t.videoHeight;let i=null;const s=()=>{e.width=t.videoWidth,e.height=t.videoHeight;e.getContext("2d").drawImage(t,0,0,e.width,e.height),i=e.toDataURL("image/jpeg"),this.image.src=i,this.element.classList.add("is-populated"),t.pause(),t.removeAttribute("src"),t.load(),t.removeEventListener("seeked",s),t.removeEventListener("error",a)},a=()=>{t.pause(),t.removeAttribute("src"),t.load(),t.removeEventListener("seeked",s),t.removeEventListener("error",a)};t.src=this.item.publicUrl,t.currentTime=10,t.addEventListener("seeked",s)}getImage(){this.image.src=this.item.publicUrl,this.element.classList.add("is-populated")}destruct(){this.detachEvents(),this.findButton=null,this.fileName=null,this.value=null,this.image=null,this.remove=null,this.element=null}}e.addPlugin("backend.formwidgets.mediafinder",i),e["backend.ui.widgetHandler"]().register("mediafinder","backend.formwidgets.mediafinder")})(window.Snowboard,window.jQuery)}},function(e){var t;t=685,e(e.s=t)}]);